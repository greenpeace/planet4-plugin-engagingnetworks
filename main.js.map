{"version":3,"sources":["partials/blocks_wide.js","partials/enform_side_style.js","partials/enform_submit.js"],"names":["$","document","ready","$wideblocks","$container","eq","force_wide_blocks","isLarge","window","width","vw","each","this","hasClass","css","innerWidth","margin","attr","length","on","$enform","setContainerWidth","find","rightOffset","offset","left","leftOffset","height","validateForm","form","formIsValid","elements","element","removeClass","errorDiv","next","remove","removeErrorMessage","formValue","val","test","String","toLowerCase","addClass","$invalidDiv","html","data","insertAfter","addErrorMessage","hideENSpinner","hide","submit","e","preventDefault","off","url","en_vars","ajaxurl","show","ajax","type","action","_wpnonce","done","response","token","formData","sessionToken","uri","contentType","crossDomain","headers","ens-auth-token","JSON","stringify","redirectURL","location","s","fail","console","log","always","submitToEn","supporter","questions","i","field","name","indexOf","id","split","serializeArray","value","replace","standardFieldNames","getFormData","google_tag_value","dataLayer","push","event"],"mappings":"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","file":"main.js","sourcesContent":["// Force wide blocks outside the container\n$(document).ready(function() {\n  'use strict';\n\n  var $wideblocks = $('.block-wide');\n  var $container = $('div.page-template, div.container').eq(0);\n\n  function force_wide_blocks() {\n    var isLarge = $(window).width() >= 992;\n    var vw = $container.width();\n    $wideblocks.each(function() {\n      if ($(this).hasClass('enform-side-style') && isLarge) {\n        $(this).css('margin-left', '');\n        $(this).css('margin-right', '');\n      } else {\n        var width = $(this).innerWidth();\n\n        var margin = ((vw - width) / 2);\n\n        if ($('html').attr('dir') === 'rtl') {\n          $(this).css('margin-left', 'auto');\n          $(this).css('margin-right', margin + 'px');\n        } else {\n          $(this).css('margin-left', margin + 'px');\n        }\n      }\n    });\n  }\n\n  if ($wideblocks.length > 0 && $container.length > 0) {\n    force_wide_blocks();\n    $(window).on('resize', force_wide_blocks);\n  } else {\n    $('.block-wide').attr('style','margin: 0px !important;padding-left: 0px !important;padding-right: 0px !important');\n    $('iframe').attr('style','left: 0');\n  }\n});\n","// Force wide blocks outside the container\n$(document).ready(function() {\n  'use strict';\n  var $container = $('div.page-template, div.container').eq(0);\n\n  if (!$container.length) {\n    $container = $('div.page-template').eq(0);\n  }\n\n  var $enform = $('.enform-wrap.enform-side-style');\n\n  function setContainerWidth() {\n    var isLarge = $(window).width() >= 992;\n\n    if (isLarge) {\n      $container.find('h1').css('width', '50%');\n      $container.find('h3').css('width', '50%');\n\n      $enform.css('box-sizing', 'border-box')\n        .css('position', 'absolute')\n        .css('z-index', '4')\n        .css('top', '80px');\n\n      if ($('html').attr('dir') === 'rtl') {\n        var rightOffset = $container.offset().left - $container.width();\n        $enform.css('left', rightOffset + 'px');\n        $enform.css('right', '');\n      } else {\n        var leftOffset = $container.offset().left;\n        $enform.css('right', leftOffset + 'px');\n        $enform.css('left', '');\n      }\n\n      $container.css('min-height', $enform.height() + 'px');\n    } else {\n      $container.find('h1').css('width', '');\n      $container.find('h3').css('width', '');\n      $container.find('.row').css('width', '');\n      $container.css('min-height', '');\n      $enform.css('box-sizing', 'border-box')\n        .css('position', '')\n        .css('top', '')\n        .css('right', '')\n        .css('left', '')\n        .css('height', '');\n    }\n  }\n\n  if ($enform) {\n    setContainerWidth();\n    $(window).on('resize', setContainerWidth);\n  }\n});","/* global en_vars, google_tag_value, dataLayer */\n$(document).ready(function () {\n  'use strict';\n\n  function addChangeListeners(form) {\n    $(form.elements).each(function() {\n      $(this).off('change').on('change', function() {\n        validateForm(form);\n      });\n    });\n  }\n\n  function validateEmail(email) {\n    // Reference: https://stackoverflow.com/questions/46155/how-to-validate-an-email-address-in-javascript\n    var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  }\n\n  function validateUrl(url) {\n    return /^(https?|s?ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i.test(url);  //eslint-disable-line no-useless-escape\n  }\n\n  function addErrorMessage(element) {\n    $(element).addClass('is-invalid');\n    var $invalidDiv = $('<div>');\n    $invalidDiv.addClass('invalid-feedback');\n    $invalidDiv.html($(element).data('errormessage'));\n    $invalidDiv.insertAfter(element);\n  }\n\n  function removeErrorMessage(element) {\n    $(element).removeClass('is-invalid');\n    var errorDiv = $(element).next();\n    if (errorDiv.length && errorDiv.hasClass('invalid-feedback')) {\n      $(errorDiv).remove();\n    }\n  }\n\n  function validateForm(form) {\n    var formIsValid = true;\n\n    $(form.elements).each(function() {\n      removeErrorMessage(this);\n      var formValue = $(this).val();\n\n      if (\n        $(this).attr('required') && ! formValue ||\n        'email' === $(this).attr('type') && ! validateEmail( formValue )\n      ) {\n        addErrorMessage(this);\n        formIsValid = false;\n      }\n    });\n\n    return formIsValid;\n  }\n\n  // Submit to a en page process api endpoint.\n  function submitToEn(formData, sessionToken) {\n    const form = $('#enform');\n    var en_page_id = $('input[name=en_page_id]').val(),\n      uri = `https://e-activist.com/ens/service/page/${en_page_id}/process`;\n    $.ajax({\n      url: uri,\n      type: 'POST',\n      contentType: 'application/json',\n      crossDomain: true,\n      headers: {\n        'ens-auth-token': sessionToken\n      },\n      data: JSON.stringify(formData),\n    }).done(function () {\n      var redirectURL = form.data('redirect-url');\n\n      if (validateUrl(redirectURL)) {\n        window.location = redirectURL;\n      } else {\n        var s =\n          '<h2 class=\"thankyou\">' +\n          '<span class=\"thankyou-title\">'+ $('input[name=thankyou_title]').val() +'</span><br />' +\n          ' <span class=\"thankyou-subtitle\">'+  $('input[name=thankyou_subtitle]').val() +'</span> ' +\n          '</h2>';\n\n        form.html(s);\n      }\n      $('.enform-notice').html('');\n    }).fail(function (response) {\n      $('.enform-notice').html('<span class=\"enform-error\">There was a problem with the submission</span>');\n      console.log(response); //eslint-disable-line no-console\n    }).always(function() {\n      hideENSpinner();\n    });\n  }\n\n  // Get enform fields data and prepare them for submission to en api.\n  function getFormData() {\n    let supporter = {\n      questions: {}\n    };\n\n    // Prepare the questions/optins values the way that ENS api expects them.\n    $('.en__field__input--checkbox:checked').val('Y');\n    $.each($('.en__field__input--checkbox:not(\":checked\")'), function (i, field) {\n      if (field.name.indexOf('supporter.questions.') >= 0) {\n        let id = field.name.split('.')[2];\n        supporter.questions['question.' + id] = 'N';\n      }\n    });\n\n    $.each($('#p4en_form').serializeArray(), function (i, field) {\n      if (field.name.indexOf('supporter.questions.') >= 0) {\n        let id = field.name.split('.')[2];\n        supporter.questions['question.' + id] = field.value;\n      } else if (field.name.indexOf('supporter.') >= 0 && '' != field.value) {\n        supporter[field.name.replace('supporter.', '')] = field.value;\n      }\n    });\n\n    var requestBody = {\n      standardFieldNames: true,\n      supporter: supporter\n    };\n    return requestBody;\n  }\n\n  function showENSpinner() {\n    $('#p4en_form_save_button').attr('disabled', true);\n    $('.en-spinner').show();\n    $('.enform-notice').html('');\n\n  }\n  function hideENSpinner() {\n    $('#p4en_form_save_button').attr('disabled', false);\n    $('.en-spinner').hide();\n  }\n\n  // Submit handler for enform\n  $('#p4en_form').submit(function (e) {\n    e.preventDefault();\n\n    // Don't bug users with validation before the first submit\n    addChangeListeners(this);\n\n    if (validateForm(this)) {\n      const url = en_vars.ajaxurl;\n\n      showENSpinner();\n      $.ajax({\n        url: url,\n        type: 'POST',\n        data: {\n          action: 'get_en_session_token',\n          '_wpnonce': $('#_wpnonce', $(this)).val(),\n        },\n      }).done(function (response) {\n        var token = response.token;\n\n        if ('' !== token) {\n          var values = getFormData();\n          submitToEn(values, token);\n\n          // DataLayer push event on EN form submission.\n          if ( typeof google_tag_value !== 'undefined' && google_tag_value ) {\n            dataLayer.push({\n              'event' : 'petitionSignup'\n            });\n          }\n        } else {\n          hideENSpinner();\n          $('.enform-notice').html('There was a problem with the submission');\n        }\n      }).fail(function (response) {\n        hideENSpinner();\n        $('.enform-notice').html('There was a problem with the submission');\n        console.log(response); //eslint-disable-line no-console\n      });\n    }\n  });\n});\n"]}