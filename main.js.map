{"version":3,"sources":["partials/blocks_wide.js","partials/enform_submit.js"],"names":["$","document","ready","$wideblocks","$container","eq","force_wide_blocks","vw","width","each","this","innerWidth","margin","attr","css","length","window","on","addErrorMessage","element","addClass","$invalidDiv","html","data","insertAfter","validateForm","form","formIsValid","elements","removeClass","errorDiv","next","hasClass","remove","removeErrorMessage","formValue","val","test","String","toLowerCase","submit","e","preventDefault","off","$content","url","en_vars","ajaxurl","values","i","field","name","indexOf","id","split","serializeArray","value","ajax","type","action","_wpnonce","en_page_id","done","response","redirectURL","location","fail","console","log"],"mappings":"AACAA,EAAAC,UAAAC,MAAA,WACA,aAEA,IAAAC,EAAAH,EAAA,eACAI,EAAAJ,EAAA,oCAAAK,GAAA,GAEA,SAAAC,IACA,IAAAC,EAAAH,EAAAI,QACAL,EAAAM,KAAA,WACA,IAAAD,EAAAR,EAAAU,MAAAC,aAEAC,GAAAL,EAAAC,GAAA,EAEA,QAAAR,EAAA,QAAAa,KAAA,QACAb,EAAAU,MAAAI,IAAA,cAAA,QACAd,EAAAU,MAAAI,IAAA,eAAAF,EAAA,OAEAZ,EAAAU,MAAAI,IAAA,cAAAF,EAAA,QAKAT,EAAAY,OAAA,GAAAX,EAAAW,OAAA,GACAT,IACAN,EAAAgB,QAAAC,GAAA,SAAAX,KAEAN,EAAA,eAAAa,KAAA,QAAA,qFACAb,EAAA,UAAAa,KAAA,QAAA,cC3BAb,EAAAC,UAAAC,MAAA,WACA,aAgBA,SAAAgB,EAAAC,GACAnB,EAAAmB,GAAAC,SAAA,cACA,IAAAC,EAAArB,EAAA,SACAqB,EAAAD,SAAA,oBACAC,EAAAC,KAAAtB,EAAAmB,GAAAI,KAAA,iBACAF,EAAAG,YAAAL,GAWA,SAAAM,EAAAC,GACA,IAAAC,GAAA,EAmBA,OAjBA3B,EAAA0B,EAAAE,UAAAnB,KAAA,YAXA,SAAAU,GACAnB,EAAAmB,GAAAU,YAAA,cACA,IAAAC,EAAA9B,EAAAmB,GAAAY,OACAD,EAAAf,QAAAe,EAAAE,SAAA,qBACAhC,EAAA8B,GAAAG,SAQAC,CAAAxB,MACA,IAAAyB,EAAAnC,EAAAU,MAAA0B,MAEApC,EAAAU,MAAAG,KAAA,cAAAsB,GACAjB,EAAAR,MAEAiB,GAAA,GACA,UAAA3B,EAAAU,MAAAG,KAAA,WACAc,EAhCA,wJACAU,KAAAC,OA+BAH,GA/BAI,iBAkCArB,EAAAR,SAKAiB,EAGA3B,EAAA,cAAAwC,OAAA,SAAAC,GArDA,IAAAf,EAsDAe,EAAAC,iBAtDAhB,EAyDAhB,KAxDAV,EAAA0B,EAAAE,UAAAnB,KAAA,WACAT,EAAAU,MAAAiC,IAAA,UAAA1B,GAAA,SAAA,WACAQ,EAAAC,OAwDA,MAAAkB,EAAA5C,EAAA,WACA,GAAAyB,EAAAf,MAAA,CACA,MAAAmC,EAAAC,QAAAC,QACA,IAAAC,EAAA,GAGAhD,EAAA,uCAAAoC,IAAA,KACApC,EAAAS,KAAAT,EAAA,+CAAA,SAAAiD,EAAAC,GACA,GAAAA,EAAAC,KAAAC,QAAA,yBAAA,EAAA,CACA,IAAAC,EAAAH,EAAAC,KAAAG,MAAA,KAAA,GACAN,EAAA,sBAAAK,GAAA,OAIArD,EAAAS,KAAAT,EAAA,cAAAuD,iBAAA,SAAAN,EAAAC,GACA,GAAAA,EAAAC,KAAAC,QAAA,yBAAA,EAAA,CACA,IAAAC,EAAAH,EAAAC,KAAAG,MAAA,KAAA,GACAN,EAAA,sBAAAK,GAAAH,EAAAM,WAEAR,EAAAE,EAAAC,MAAAD,EAAAM,QAIAxD,EAAAyD,KAAA,CACAZ,IAAAA,EACAa,KAAA,OACAnC,KAAA,CACAoC,OAAA,gBACAC,SAAA5D,EAAA,aAAAoC,MACAyB,WAAA7D,EAAA,0BAAAoC,MACAY,OAAAA,KAEAc,KAAA,SAAAC,GACA,IAAAC,EAAApB,EAAArB,KAAA,gBAcA,uqCAAAc,KAZA2B,GACAhD,OAAAiD,SAAAD,EAEApB,EAAAtB,KAAAyC,KAEAG,KAAA,SAAAH,GACAI,QAAAC,IAAAL","file":"main.js","sourcesContent":["// Force wide blocks outside the container\n$(document).ready(function() {\n  'use strict';\n\n  var $wideblocks = $('.block-wide');\n  var $container = $('div.page-template, div.container').eq(0);\n\n  function force_wide_blocks() {\n    var vw = $container.width();\n    $wideblocks.each(function() {\n      var width = $(this).innerWidth();\n\n      var margin = ((vw - width) / 2);\n\n      if ($('html').attr('dir') === 'rtl') {\n        $(this).css('margin-left', 'auto');\n        $(this).css('margin-right', margin + 'px');\n      } else {\n        $(this).css('margin-left', margin + 'px');\n      }\n    });\n  }\n\n  if ($wideblocks.length > 0 && $container.length > 0) {\n    force_wide_blocks();\n    $(window).on('resize', force_wide_blocks);\n  } else {\n    $('.block-wide').attr('style','margin: 0px !important;padding-left: 0px !important;padding-right: 0px !important');\n    $('iframe').attr('style','left: 0');\n  }\n});\n  ","/* global en_vars */\n$(document).ready(function () {\n  'use strict';\n\n  function addChangeListeners(form) {\n    $(form.elements).each(function() {\n      $(this).off('change').on('change', function() {\n        validateForm(form);\n      });\n    });\n  }\n\n  function validateEmail(email) {\n    // Reference: https://stackoverflow.com/questions/46155/how-to-validate-an-email-address-in-javascript\n    var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  }\n\n  function addErrorMessage(element) {\n    $(element).addClass('is-invalid');\n    var $invalidDiv = $('<div>');\n    $invalidDiv.addClass('invalid-feedback');\n    $invalidDiv.html($(element).data('errormessage'));\n    $invalidDiv.insertAfter(element);\n  }\n\n  function removeErrorMessage(element) {\n    $(element).removeClass('is-invalid');\n    var errorDiv = $(element).next();\n    if (errorDiv.length && errorDiv.hasClass('invalid-feedback')) {\n      $(errorDiv).remove();\n    }\n  }\n\n  function validateForm(form) {\n    var formIsValid = true;\n\n    $(form.elements).each(function() {\n      removeErrorMessage(this);\n      var formValue = $(this).val();\n\n      if ($(this).attr('required') && !formValue) {\n        addErrorMessage(this);\n\n        formIsValid = false;\n      } else if ('email' === $(this).attr('type')) {\n        formIsValid = validateEmail(formValue);\n\n        if (!formIsValid) {\n          addErrorMessage(this);\n        }\n      }\n    });\n\n    return formIsValid;\n  }\n\n  $('#p4en_form').submit(function(e) {\n    e.preventDefault();\n\n    // Don't bug users with validation before the first submit\n    addChangeListeners(this);\n\n    const $content = $('#enform');\n    if (validateForm(this)) {\n      const url = en_vars.ajaxurl;\n      let values = {};\n\n      // Prepare the questions/optins values the way that ENS api expects them.\n      $('.en__field__input--checkbox:checked').val('Y');\n      $.each($('.en__field__input--checkbox:not(\":checked\")'), function(i, field) {\n        if ( field.name.indexOf( 'supporter.questions.' ) >= 0 ) {\n          let id = field.name.split('.')[2];\n          values['supporter.question.' + id] = 'N';\n        }\n      });\n\n      $.each($('#p4en_form').serializeArray(), function(i, field) {\n        if ( field.name.indexOf( 'supporter.questions.' ) >= 0 ) {\n          let id = field.name.split('.')[2];\n          values['supporter.question.' + id] = field.value;\n        } else {\n          values[field.name] = field.value;\n        }\n      });\n\n      $.ajax({\n        url: url,\n        type: 'POST',\n        data: {\n          action:     'handle_submit',\n          '_wpnonce': $( '#_wpnonce' ).val(),\n          'en_page_id': $('input[name=en_page_id]').val(),\n          values: values,\n        },\n      }).done(function ( response ) {\n        var redirectURL = $content.data('redirect-url');\n\n        if ( is_valid_url( redirectURL ) ) {\n          window.location = redirectURL;\n        } else {\n          $content.html( response );\n        }\n      }).fail(function ( response ) {\n        console.log(response); //eslint-disable-line no-console\n      });  \n    }\n  });\n\n  function is_valid_url(url) {\n    return /^(https?|s?ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i.test(url);  //eslint-disable-line no-useless-escape\n  }\n});\n"]}