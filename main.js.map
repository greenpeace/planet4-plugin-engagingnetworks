{"version":3,"sources":["partials/blocks_wide.js","partials/enform_side_style.js","partials/enform_submit.js"],"names":["$","document","ready","$wideblocks","$container","eq","force_wide_blocks","vw","width","each","this","innerWidth","margin","attr","css","length","window","on","$sideStyleForm","$enform","find","setContainerWidth","isLarge","captionHeight","outerHeight","p4_enform_frontend","enform","getFormData","supporter","questions","val","i","field","name","indexOf","id","split","serializeArray","value","replace","standardFieldNames","addChangeListeners","form","elements","off","validateForm","validateEmail","email","test","String","toLowerCase","validateUrl","url","addErrorMessage","element","msg","data","addClass","$invalidDiv","html","insertAfter","removeErrorMessage","removeClass","errorDiv","next","hasClass","remove","formIsValid","formValue","callbackFunction","validateField","submitToEn","formData","sessionToken","uri","ajax","type","contentType","crossDomain","headers","ens-auth-token","JSON","stringify","done","redirectURL","location","s","fail","response","console","log","always","hideENSpinner","showENSpinner","show","hide","jQuery","submit","e","preventDefault","en_vars","ajaxurl","action","_wpnonce","token","values","google_tag_value","dataLayerPayload","event","gGoal","dataLayer","push"],"mappings":"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","file":"main.js","sourcesContent":["// Force wide blocks outside the container\n$(document).ready(function() {\n  'use strict';\n\n  var $wideblocks = $('.block-wide');\n  var $container = $('div.page-template, div.container').eq(0);\n\n  function force_wide_blocks() {\n    var vw = $container.width();\n    $wideblocks.each(function() {\n      var width = $(this).innerWidth();\n\n      var margin = ((vw - width) / 2);\n\n      if ($('html').attr('dir') === 'rtl') {\n        $(this).css('margin-left', 'auto');\n        $(this).css('margin-right', margin + 'px');\n      } else {\n        $(this).css('margin-left', margin + 'px');\n      }\n    });\n  }\n\n  if ($wideblocks.length > 0 && $container.length > 0) {\n    force_wide_blocks();\n    $(window).on('resize', force_wide_blocks);\n  } else {\n    $('.block-wide').attr('style','margin: 0px !important;padding-left: 0px !important;padding-right: 0px !important');\n    $('iframe').attr('style','left: 0');\n  }\n});\n","// Force wide blocks outside the container\n$(document).ready(function() {\n  'use strict';\n  var $container = $('div.page-template, div.container').eq(0);\n\n  if (!$container.length) {\n    $container = $('div.page-template').eq(0);\n  }\n\n  var $sideStyleForm = $('.enform-wrap.enform-side-style');\n  var $enform = $sideStyleForm.find('.enform');\n\n  function setContainerWidth() {\n    var isLarge = $(window).width() >= 992;\n    var vw = $(window).width();\n\n    if (!isLarge) {\n      var margin = ((vw - $container.innerWidth()) / 2);\n\n      if ($('html').attr('dir') === 'rtl') {\n        $enform.css('margin-left', 'auto');\n        $enform.css('margin-right', - margin + 'px');\n        $enform.css('padding-right', margin + 'px');\n        $enform.css('padding-left', margin + 'px');\n      } else {\n        $enform.css('margin-left', - margin + 'px');\n        $enform.css('padding-left', margin + 'px');\n        $enform.css('padding-right', margin + 'px');\n      }\n\n      var captionHeight = $sideStyleForm.find('.form-caption').outerHeight();\n      $sideStyleForm.find('picture img').css('height', captionHeight + 'px');\n    } else {\n      $enform.css('margin-left', '');\n      $enform.css('margin-right', '');\n      $enform.css('padding-left', '');\n      $enform.css('padding-right', '');\n      $sideStyleForm.find('picture img').css('height', '100%');\n    }\n  }\n\n  if ($sideStyleForm) {\n    setContainerWidth();\n    $(window).on('resize', setContainerWidth);\n  }\n});","/* global en_vars, google_tag_value, dataLayer */\n\nvar p4_enform_frontend = (function ($) {\n\n  var enform = {};\n\n  enform.getFormData = function() {\n    let supporter = {\n      questions: {}\n    };\n\n    // Prepare the questions/optins values the way that ENS api expects them.\n    $('.en__field__input--checkbox:checked').val('Y');\n    $.each($('.en__field__input--checkbox:not(\":checked\")'), function (i, field) {\n      if (field.name.indexOf('supporter.questions.') >= 0) {\n        let id = field.name.split('.')[2];\n        supporter.questions['question.' + id] = 'N';\n      }\n    });\n\n    $.each($('#p4en_form').serializeArray(), function (i, field) {\n      if (field.name.indexOf('supporter.questions.') >= 0) {\n        let id = field.name.split('.')[2];\n        supporter.questions['question.' + id] = field.value;\n      } else if (field.name.indexOf('supporter.') >= 0 && '' !== field.value) {\n        supporter[field.name.replace('supporter.', '')] = field.value;\n      }\n    });\n\n    return {\n      standardFieldNames: true,\n      supporter: supporter\n    };\n  };\n\n  enform.addChangeListeners = function(form) {\n    $(form.elements).each(function () {\n      $(this).off('change').on('change', function () {\n        enform.validateForm(form);\n      });\n    });\n  };\n\n  enform.validateEmail = function(email) {\n    // Reference: https://stackoverflow.com/questions/46155/how-to-validate-an-email-address-in-javascript\n    var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  };\n\n  enform.validateUrl = function(url) {\n    return /^(https?|s?ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i.test(url);  //eslint-disable-line no-useless-escape\n  };\n\n  enform.addErrorMessage = function(element,msg) {\n    if ('undefined' === typeof msg) {\n      msg = $(element).data('errormessage');\n    }\n    $(element).addClass('is-invalid');\n    var $invalidDiv = $('<div>');\n    $invalidDiv.addClass('invalid-feedback');\n    $invalidDiv.html(msg);\n    $invalidDiv.insertAfter(element);\n  };\n\n  enform.removeErrorMessage = function(element) {\n    $(element).removeClass('is-invalid');\n    var errorDiv = $(element).next();\n    if (errorDiv.length && errorDiv.hasClass('invalid-feedback')) {\n      $(errorDiv).remove();\n    }\n  };\n\n  enform.validateForm = function(form) {\n    var formIsValid = true;\n\n    $(form.elements).each(function () {\n      enform.removeErrorMessage(this);\n      var formValue = $(this).val();\n\n      if (\n        $(this).attr('required') && !formValue ||\n        'email' === $(this).attr('type') && !enform.validateEmail(formValue)\n      ) {\n        enform.addErrorMessage(this);\n        formIsValid = false;\n      }\n\n      var callbackFunction = $(this).attr('validate_callback');\n      if ('function' === typeof window[callbackFunction]) {\n        var validateField = window[callbackFunction]($(this).val());\n        if (true !== validateField) {\n          enform.addErrorMessage(this, validateField);\n          formIsValid = false;\n        }\n      }\n    });\n\n    return formIsValid;\n  };\n\n  // Submit to a en page process api endpoint.\n  enform.submitToEn = function(formData, sessionToken) {\n    const form = $('#enform');\n    var en_page_id = $('input[name=en_page_id]').val(),\n      uri = `https://e-activist.com/ens/service/page/${en_page_id}/process`;\n    $.ajax({\n      url: uri,\n      type: 'POST',\n      contentType: 'application/json',\n      crossDomain: true,\n      headers: {\n        'ens-auth-token': sessionToken\n      },\n      data: JSON.stringify(formData),\n    }).done(function () {\n      var redirectURL = form.data('redirect-url');\n\n      if (enform.validateUrl(redirectURL)) {\n        window.location = redirectURL;\n      } else {\n        var s =\n          '<h2 class=\"thankyou\">' +\n          '<span class=\"thankyou-title\">' + $('input[name=thankyou_title]').val() + '</span><br />' +\n          ' <span class=\"thankyou-subtitle\">' + $('input[name=thankyou_subtitle]').val() + '</span> ' +\n          '</h2>';\n\n        form.html(s);\n      }\n      $('.enform-notice').html('');\n    }).fail(function (response) {\n      $('.enform-notice').html('<span class=\"enform-error\">There was a problem with the submission</span>');\n      console.log(response); //eslint-disable-line no-console\n    }).always(function () {\n      enform.hideENSpinner();\n    });\n  };\n\n\n  enform.showENSpinner = function() {\n    $('#p4en_form_save_button').attr('disabled', true);\n    $('.en-spinner').show();\n    $('.enform-notice').html('');\n\n  };\n\n  enform.hideENSpinner = function() {\n    $('#p4en_form_save_button').attr('disabled', false);\n    $('.en-spinner').hide();\n  };\n\n  return enform;\n\n})(jQuery);\n\n\n$(document).ready(function () {\n  'use strict';\n\n  // Submit handler for enform\n  $('#p4en_form').submit(function (e) {\n    e.preventDefault();\n\n    // Don't bug users with validation before the first submit\n    p4_enform_frontend.addChangeListeners(this);\n\n    if (p4_enform_frontend.validateForm(this)) {\n      const url = en_vars.ajaxurl;\n\n      p4_enform_frontend.showENSpinner();\n      $.ajax({\n        url: url,\n        type: 'POST',\n        data: {\n          action: 'get_en_session_token',\n          '_wpnonce': $('#_wpnonce', $(this)).val(),\n        },\n      }).done(function (response) {\n        var token = response.token;\n\n        if ('' !== token) {\n          var values = p4_enform_frontend.getFormData();\n          p4_enform_frontend.submitToEn(values, token);\n\n          // DataLayer push event on EN form submission.\n          if ( typeof google_tag_value !== 'undefined' && google_tag_value ) {\n            var dataLayerPayload = {\n              'event' : 'petitionSignup'\n            };\n\n            var gGoal = $('#enform_goal').val();\n            if ( gGoal ) {\n              dataLayerPayload.gGoal = gGoal;\n            }\n\n            dataLayer.push(dataLayerPayload);\n          }\n        } else {\n          p4_enform_frontend.hideENSpinner();\n          $('.enform-notice').html('There was a problem with the submission');\n        }\n      }).fail(function (response) {\n        p4_enform_frontend.hideENSpinner();\n        $('.enform-notice').html('There was a problem with the submission');\n        console.log(response); //eslint-disable-line no-console\n      });\n    }\n  });\n});\n"]}